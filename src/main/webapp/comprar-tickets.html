<!doctype html>
<html lang="es">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">
  <link rel="stylesheet" href="css/estilos-propios.css">
  <link rel="shortcut icon" href="./img/codoacodo-min.png" type="image/x-icon">

  <title>Trabajo Integrador: Comprar tickets</title>
    <!-- Añade este script para cargar el SDK de PayPal -->
    <script src="https://www.paypal.com/sdk/js?client-id=Aea1KL6c9xHA9rRKjlMQNuOnv6pYSmbnMS7u-9Fddo1hXUjr_MJuM2MrET2lQnQLeGmO38itEIZOAIR6&currency=USD"  ></script>

    <style>

    .switch{margin-left: 8px;}
    .propia{
        display:block;
    }
    .none{
        display:none;
    }
   
  </style>
</head>
<body>

<header>
    <nav class="navbar navbar-dark bg-dark fixed-top navbar-expand-lg">
        <div class="container">
            <a class="navbar-brand" href="index.html">
                <img src="img/codoacodo-min.png" alt="Codo a Codo logo">
                Conf Bs As
            </a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse"
                data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false"
                aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse justify-content-end" id="navbarSupportedContent">
                <ul class="navbar-nav mb-2 mb-lg-0">
                    <li class="nav-item">
                        <a class="nav-link" href="./index.jsp">La conferencia</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="./index.jsp#oradores">Los oradores</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="./index.jsp#lugar">El lugar y la fecha</a>
                    </li>
                    <li class="nav-item">

                        <a class="nav-link" href="./index.jsp#form-orador">Conviertete en orador</a>

                    </li>
                    <li class="nav-item">
                        <a class="nav-link btn-compra-tickets active" aria-current="page" href="#">Comprar tickets</a>
                    </li>

                </ul>


                </ul>
                <button class="switch" id="switch">
                    <span><i class="fas fa-sun"></i></span>
                    <span><i class="fas fa-moon"></i></span>
                </button>

            </div>
        </div>
    </nav>
</header>








<main>

    <section class="container pt-section">
        <div class="row justify-content-center">
            <div class="col-lg-8 col-xl-7">

                <div class="row row-cols-1 row-cols-md-3 text-center">
                    <div class="col">
                        <div class="card mb-4 rounded-3 shadow-sm border-primary">
                            <div class="card-header py-3 text-white bg-primary border-primary">
                                <h4 class="my-0 fw-normal">Estudiante</h4>
                            </div>
                            <div class="card-body">
                                <p>Tienen un descuento</p>
                                <h3 class="card-title pricing-card-title">80%</h3>
                                <small class="fw-light text-muted mt-3">* Presentar documentación</small>
                            </div>
                        </div>
                    </div>
                    <div class="col">
                        <div class="card mb-4 rounded-3 shadow-sm border-info">
                            <div class="card-header py-3 text-white bg-info border-info">
                                <h4 class="my-0 fw-normal">Trainee</h4>
                            </div>
                            <div class="card-body">
                                <p>Tienen un descuento</p>
                                <h3 class="card-title pricing-card-title">50%</h3>
                                <small class="fw-light text-muted mt-3">* Presentar documentación</small>
                            </div>
                        </div>
                    </div>
                    <div class="col">
                        <div class="card mb-4 rounded-3 shadow-sm border-warning">
                            <div class="card-header py-3 text-white bg-warning border-warning">
                                <h4 class="my-0 fw-normal">Junior</h4>
                            </div>
                            <div class="card-body">
                                <p>Tienen un descuento</p>
                                <h3 class="card-title pricing-card-title">15%</h3>
                                <small class="fw-light text-muted mt-3">* Presentar documentación</small>
                            </div>
                        </div>
                    </div>
                </div>

                <h2 class="titulo-gral">Venta <span>Valor de ticket $200</span></h2>
                
                <form action="">
                    <div class="row gx-2">
                        <div class="col-md mb-3">
                            <input type="text" class="form-control" placeholder="Nombre" aria-label="Nombre" id="nombre" required>
                            <div class="invalid-feedback" id="mensajeErrorNombre">
                               <p>Ingrese su nombre</p>
                            </div>
                        </div>
                        <div class="col-md mb-3">
                            <input type="text" class="form-control" placeholder="Apellido" aria-label="Apellido" id="apellido" required>
                            <div class="invalid-feedback" id="mensajeErrorApellido">
                                <p>Ingrese su apellido</p>
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col mb-3">
                            <input type="email" class="form-control" placeholder="Email" aria-label="Email" id="mail" required>
                            <div class="invalid-feedback" id="mensajeErrorMail">
                                <p>Ingrese un mail y valido</p>
                            </div>
                           
                        </div>
                    </div>
                    <div class="row gx-2">
                        <div class="col-md mb-3">
                            <label for="cantidadTickets" class="form-label">Cantidad</label>
                            <input type="number" class="form-control" placeholder="Cantidad" aria-label="Cantidad" id="cantidadTickets" min="1" required>
                            <div class="invalid-feedback" id="mensajeErrorCantTickets">
                                <p>Ingrese cantidad de tickets</p>
                            </div>
                        </div>
                        <div class="col-md mb-3">
                            <label for="categoriaSelect" class="form-label">Categoría</label>
                            <select class="form-select" aria-label="Categoría" id="categoriaSelect">
                                <option value="" selected>-- Seleccione --</option>
                                <option value="0">Sin Categoria</option>
                                <option value="1">Estudiante</option>
                                <option value="2">Trainee</option>
                                <option value="3">Junior</option>
                            </select>
                            <div class="invalid-feedback" id="mensajeErrorCategoria">
                                <p>Ingrese una categoria</p>
                            </div>
                        </div>
                    </div>
                    <div class="alert alert-primary mt-2 mb-4" role="alert">
                        Total a pagar: $ <span id="totalPago" class="align-middle"></span>
                    </div>
                    <div class="row gx-2">
                        <div class="col-md mb-3">
                            <button type="reset" class="w-100 btn btn-lg btn-form" id="btnBorrar">Borrar</button>
                        </div>
                        <div class="col-md mb-3">
                            <button type="button" class="w-100 btn btn-lg btn-form" id="btnResumen">Resumen</button>
                        </div>
                    </div>
                </form>

                <form action="" id="formulario-pago">



                    <div id="paypal-button-container"></div>
                </form>

            </div>
        </div>
    </section>

</main>

<footer id="main-footer">
    <div class="container">
        <ul class="nav justify-content-center justify-content-lg-between align-items-center">
            <li class="nav-item">
                <a class="nav-link" href="#">Preguntas <span>frecuentes</span></a>
            </li>
            <li class="nav-item">

                <a class="nav-link" href="#">Contactanos</a>

            </li>
            <li class="nav-item">
                <a class="nav-link" href="#">Prensa</a>
            </li>
            <li class="nav-item">
                <a class="nav-link" href="#">Conferencias</a>
            </li>
            <li class="nav-item">

                <a class="nav-link" href="#">Terminos y <span>condiciones</span></a>

            </li>
            <li class="nav-item">
                <a class="nav-link" href="#">Privacidad</a>
            </li>
            <li class="nav-item">
                <a class="nav-link" href="#">Estudiantes</a>
            </li>
        </ul>
    </div>
</footer>

<script src="js/comprar-tickets.js"></script>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-ka7Sk0Gln4gmtz2MlQnikT1wXgYsOg+OMhuP+IlRH9sENBO0LRn5q+8nbTov4+1p" crossorigin="anonymous"></script>

<script>

    document.addEventListener('DOMContentLoaded', function() {

            // Elementos en variables
            let nombre = document.getElementById("nombre");
            let apellido = document.getElementById("apellido");
            let mail = document.getElementById("mail");
            let cantidadTickets = document.getElementById("cantidadTickets");
            let mensajeErrorCantTickets = document.getElementById("mensajeErrorCantTickets");
            let categoria = document.getElementById("categoriaSelect");
            let mensajeErrorCategoria = document.getElementById("mensajeErrorCategoria");

            let descuentoEstudiante = 80;
            let descuentoTrainee    = 50;
            let descuentoJunior     = 15;

        // Configura el botón de PayPal después de que el documento se haya cargado
        paypal.Buttons({
            createOrder: function(data, actions) {
                // Accede al valor numérico del elemento totalPagoElement
                totalAPagar();
                let totalValue = parseFloat(totalPago.innerText);


                // Configura la transacción de PayPal
                return actions.order.create({
                    purchase_units: [{
                        amount: {
                            value: totalValue, // Precio total a pagar
                            currency_code: 'USD'
                        }
                    }]
                });
            },


            onApprove: function(data, actions) {
                // Captura el pago cuando el usuario aprueba
                return actions.order.capture().then(function(details) {
                    // Aquí puedes realizar acciones adicionales después de la captura del pago
                    alert('Pago completado. ID de transacción: ' + details.id);
                });
            }
        }).render('#paypal-button-container');
        const totalAPagar = () => {
//function total_a_pagar() {

            // Ejecuto función para que quite todos los estilos de error en los campos que los tuvieran
            quitarClaseError();

            // Verifico si lleno los siguientes campos, sino que aplique un estilo de error, haga foco en el campo y se detenga
            if (nombre.value === "") {
                // alert("Por favor, escribí tu nombre.");
                nombre.classList.add("is-invalid");
                divErrorNombre.classList.add("propia");/*lo que hace esta clase es poner un div en display:block, ya que tiene la clase class="invalid-feedback" */
                nombre.focus();
                return;
            }

            if (apellido.value === "" ) {
                // alert("Por favor, escribí tu apellido.");
                apellido.classList.add("is-invalid");
                divErrorApellido.classList.add("propia");
                apellido.focus();
                return;
            }

            if (mail.value === "") {
                //alert("Por favor, escribí tu email.");
                mail.classList.add("is-invalid");
                //console.log(divErrorMail);
                divErrorMail.classList.add("propia");
                mail.focus();
                return;
            }

            // Para determinar si el correo electrónico es válido o no
            const emailValido = mail => {
                return /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(mail); // esto es expresiones regulares
            }

            if (!emailValido(mail.value)) {
                // alert("Por favor, escribí un correo electrónico válido.");
                mail.classList.add("is-invalid");
                divErrorMail.classList.add("propia");
                mail.focus();
                return;
            }

            // Verifico si está ingresado al menos 1 ticket, sino que aplique un estilo de error, haga foco en el campo y se detenga
            if ( (cantidadTickets.value == 0) || (isNaN(cantidadTickets.value)) ) {
                //alert("Por favor, ingresá correctamente cantidad de tickets.");
                cantidadTickets.classList.add("is-invalid");
                mensajeErrorCantTickets.classList.add("propia");
                cantidadTickets.focus();
                return;
            }

            // Verifico que haya seleccionado una categoría, sino que aplique un estilo de error, haga foco en el campo y se detenga
            if (categoria.value == "") {
                //alert("Por favor, seleccioná una categoría.");
                categoria.classList.add("is-invalid");
                mensajeErrorCategoria.classList.add("propia");
                categoria.focus();
                return;
            }

            // Multiplico cantidad de tickets por el valor
            let totalValorTickets = (cantidadTickets.value) * valorTicket;

            /* realizo un switch con categoria.value - Aplico descuentos según categoría */
            switch (categoria.value) {
                case "0":
                    totalValorTickets = totalValorTickets ;
                    break;
                case "1":
                    totalValorTickets = totalValorTickets - (descuentoEstudiante / 100 * totalValorTickets);
                    break;
                case "2":
                    totalValorTickets = totalValorTickets - (descuentoTrainee / 100 * totalValorTickets);
                    break;
                case "3":
                    totalValorTickets = totalValorTickets - (descuentoJunior / 100 * totalValorTickets);
                    break;

            }
            // Inserto el valor en el HTML
            console.log("PRECIO FINAL:", totalPago)

            totalPago.innerHTML = totalValorTickets;
            return totalPago
        }
        // Botón Resumen recibe un escuchador y la función del cálculo
        document.getElementById('btnResumen').addEventListener('click', totalAPagar);

        // Función para el botón Borrar para que borre el valor
        const resetTotalAPagar = () => {
            quitarClaseError();
            totalPago.innerHTML = "";
        }

        document.getElementById('btnBorrar').addEventListener('click', resetTotalAPagar);



    });


</script>

<script src="https://kit.fontawesome.com/06cd062310.js" crossorigin="anonymous"></script>
<script src="js/app.js"></script>


</body>
</html>